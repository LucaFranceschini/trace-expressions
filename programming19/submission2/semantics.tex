\begin{gather*}
%%%% implicit substitution version, local substitution (i.e. substitution is output only)
\Rule{main}
{\tau\extrans{\ev}\tau';\emptyset}
{\tau\trans{\ev}\tau'}
{}
\qquad
\Rule{prefix}
{}
{\eventTy\prefixop\tau\extrans{\ev}\tau;\subs}
{
  \subs=\mtch(\ev,\eventTy)
}
\qquad
\Rule{and}
{\tau_1\extrans{\ev}\tau'_1;\subs_1\quad\tau_2\extrans{\ev}\tau'_2;\subs_2}
{\tau_1\andop\tau_2\extrans{\ev}\tau'_1\andop\tau'_2;\subs}
{\subs=\subs_1\subsMerge\subs_2}
\\[1ex]
\Rule{or-l}
{\tau_1\extrans{\ev}\tau'_1;\subs}
{\tau_1\orop\tau_2\extrans{\ev}\tau'_1;\subs}
{}
\qquad
\Rule{or-r}
{\tau_2\extrans{\ev}\tau'_2;\subs}
{\tau_1\orop\tau_2\extrans{\ev}\tau'_2;\subs}
{}
\qquad
\Rule{shuffle-l}
{\tau_1\extrans{\ev}\tau'_1;\subs}
{\tau_1\shuffleop\tau_2\extrans{\ev}\tau'_1\shuffleop\tau_2;\subs}
{}
\\[1ex]
\Rule{cat-l}
{\tau_1\extrans{\ev}\tau'_1;\subs}
{\tau_1\catop\tau_2\extrans{\ev}\tau'_1\catop\tau_2;\subs}
{}
\qquad
\Rule{cat-r}
{\tau_2\extrans{\ev}\tau'_2;\subs}
{\tau_1\catop\tau_2\extrans{\ev}\tau'_2;\subs}
{\isEmpty(\tau_1)}
\qquad
\Rule{shuffle-r}
{\tau_2\extrans{\ev}\tau'_2;\subs}
{\tau_1\shuffleop\tau_2\extrans{\ev}\tau_1\shuffleop\tau'_2;\subs}
{}
\\[1ex]
\Rule{var-t}
{\tau\extrans{\ev}\tau';\subs}
{\var{\xv}{\tau}\extrans{\ev}\subs\tau';\restrict{\subs}{\xv}}
{\xv\in\dom(\subs)}
\qquad
\Rule{var-f}
{\tau\extrans{\ev}\tau';\subs}
{\var{\xv}{\tau}\extrans{\ev}\var{\xv}{\tau'};\subs}
{\xv\not\in\dom(\subs)}
\\[1ex]
\Rule{filter-t}
{\tau\extrans{\ev}\tau';\subs}
{\eventTy \filterop \tau \extrans{\ev} \eventTy \filterop \tau';\subs}
{\subs=\mtch(\ev,\eventTy)}
\qquad
\Rule{filter-f}
{}
{\eventTy \filterop \tau \extrans{\ev} \eventTy \filterop \tau}
{\not\exists\subs=\mtch(\ev,\eventTy)}
\\[1ex]
\Rule{$\isEmpty$-empty}
{}
{\isEmpty(\emptyseq)}
{}
\qquad
\Rule{$\isEmpty$-var}
{\isEmpty(\tau)}
{\isEmpty(\var{\xv}{\tau})}
{}
\\[1ex]
\Rule{$\isEmpty$-or-l}
{\isEmpty(\tau_1)}
{\isEmpty(\tau_1\orop\tau_2)}
{}
\qquad
\Rule{$\isEmpty$-or-r}
{\isEmpty(\tau_2)}
{\isEmpty(\tau_1\orop\tau_2)}
{}
\qquad
\Rule{$\isEmpty$-others}
{\isEmpty(\tau_1)\quad\isEmpty(\tau_2)}
{\isEmpty(\tau_1 \op\ \tau_2)}
{\op\in\{\shuffleop,\catop,\andop\}}
\end{gather*}
